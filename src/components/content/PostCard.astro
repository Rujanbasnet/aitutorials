---
import { formatDateShort } from '@utils/dates';
import { getReadingTime } from '@utils/reading-time';

interface Props {
  title: string;
  description: string;
  href: string;
  pubDate: Date;
  tags?: string[];
  difficulty?: string;
  image?: string;
  body?: string;
  featured?: boolean;
}

const {
  title,
  description,
  href,
  pubDate,
  tags = [],
  difficulty,
  image,
  body = '',
  featured = false,
} = Astro.props;

const readingTime = body ? getReadingTime(body) : '';

const difficultyClass: Record<string, string> = {
  beginner: 'badge-beginner',
  intermediate: 'badge-intermediate',
  advanced: 'badge-advanced',
};
---

<a href={href} class:list={['card-accent block overflow-hidden group', featured && 'md:col-span-2']}>
  {image && (
    <div class="aspect-video overflow-hidden">
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover group-hover:scale-[1.03] transition-transform duration-700 ease-out"
        loading="lazy"
      />
    </div>
  )}
  <div class="p-5 sm:p-6">
    <div class="flex flex-wrap items-center gap-2 mb-3">
      {difficulty && (
        <span class:list={['text-xs font-semibold px-2.5 py-0.5 rounded-sm uppercase tracking-wide', difficultyClass[difficulty] || 'tag']}>
          {difficulty}
        </span>
      )}
      {tags.slice(0, 2).map((tag) => (
        <span class="tag">{tag}</span>
      ))}
    </div>

    <h3 class="text-lg text-[var(--color-text-primary)] group-hover:text-[var(--color-accent)] transition-colors mb-2 line-clamp-2" style="font-family: var(--font-display)">
      {title}
    </h3>

    <p class="text-sm text-[var(--color-text-secondary)] line-clamp-2 mb-4 leading-relaxed">
      {description}
    </p>

    <div class="flex items-center gap-3 text-xs text-[var(--color-text-muted)]">
      <time datetime={pubDate.toISOString()}>{formatDateShort(pubDate)}</time>
      {readingTime && (
        <>
          <span class="opacity-40">&middot;</span>
          <span>{readingTime}</span>
        </>
      )}
    </div>
  </div>
</a>
