---
import BaseLayout from './BaseLayout.astro';
import { formatDate } from '@utils/dates';
import { getReadingTime } from '@utils/reading-time';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  author?: string;
  image?: string;
  tags?: string[];
  difficulty?: string;
  estimatedTime?: string;
  body: string;
  collection: string;
}

const {
  title,
  description,
  pubDate,
  author = 'SynthLab',
  image,
  tags = [],
  difficulty,
  estimatedTime,
  body,
  collection,
} = Astro.props;

const readingTime = getReadingTime(body);

const difficultyClass: Record<string, string> = {
  beginner: 'badge-beginner',
  intermediate: 'badge-intermediate',
  advanced: 'badge-advanced',
};
---

<BaseLayout title={title} description={description} image={image} type="article">
  <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
    <!-- Breadcrumb -->
    <nav class="mb-8 text-sm text-[var(--color-text-muted)]">
      <a href="/" class="hover:text-[var(--color-text-primary)] transition-colors">Home</a>
      <span class="mx-2 opacity-40">/</span>
      <a href={`/${collection}/`} class="hover:text-[var(--color-text-primary)] transition-colors capitalize">{collection}</a>
    </nav>

    <!-- Header -->
    <header class="mb-12">
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-5">
          {tags.map((tag) => (
            <a
              href={`/tags/${tag}/`}
              class="tag hover:text-[var(--color-accent)] hover:bg-[var(--color-accent-soft)] transition-colors"
            >
              {tag}
            </a>
          ))}
        </div>
      )}

      <h1 class="text-display mb-5">
        {title}
      </h1>

      <p class="text-lg text-[var(--color-text-secondary)] mb-8 leading-relaxed max-w-2xl">{description}</p>

      <div class="flex flex-wrap items-center gap-3 text-sm text-[var(--color-text-muted)] pb-8 border-b border-[var(--color-border)]">
        <span class="font-medium text-[var(--color-text-secondary)]">{author}</span>
        <span class="opacity-30">&middot;</span>
        <time datetime={pubDate.toISOString()}>{formatDate(pubDate)}</time>
        <span class="opacity-30">&middot;</span>
        <span>{readingTime}</span>
        {difficulty && (
          <>
            <span class="opacity-30">&middot;</span>
            <span class:list={['text-xs font-semibold px-2 py-0.5 rounded-sm uppercase tracking-wider', difficultyClass[difficulty] || 'tag']}>
              {difficulty}
            </span>
          </>
        )}
        {estimatedTime && (
          <>
            <span class="opacity-30">&middot;</span>
            <span>{estimatedTime}</span>
          </>
        )}
      </div>
    </header>

    {image && (
      <div class="mb-12 rounded-xl overflow-hidden border border-[var(--color-border)]">
        <img src={image} alt={title} class="w-full h-auto" loading="lazy" />
      </div>
    )}

    <!-- Content -->
    <div class="prose max-w-none">
      <slot />
    </div>

    <!-- Newsletter CTA -->
    <div class="mt-20 pt-10 border-t border-[var(--color-border)]">
      <div class="card-warm p-8 sm:p-10 text-center rounded-xl">
        <h3 class="text-heading mb-3">Enjoyed this article?</h3>
        <p class="text-[var(--color-text-secondary)] mb-6 max-w-md mx-auto">Subscribe for more AI insights delivered to your inbox every week.</p>
        <a
          href="/newsletter/"
          class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-[var(--color-text-primary)] text-white font-medium hover:bg-[var(--color-text-secondary)] transition-colors"
        >
          Subscribe to Newsletter
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
